(()=>{"use strict";const e={min:0,sec:0,element:null,interval:null,init(){this.element=document.createElement("time"),this.setTime()},start(){this.interval=setInterval((()=>{this._increment(),this.setTime()}),1e3)},pause(){this.interval&&(clearInterval(this.interval),this.interval=null)},restart(){this.min=this.sec=0},_increment(){this.sec++,60===this.sec&&(this.min++,this.sec=0)},setTime(){this.element.textContent=`${this._format(this.min)}:${this._format(this.sec)}`},_format:e=>e<10?"0"+e:e.toString()},t={element:null,pages:{main:{element:null,header:null,container:null,items:{newGame:null,loadGame:null,scores:null,settings:null}},saves:{element:null,init(){this.element=document.createElement("div"),this.element.classList.add("saved-games-page");const e=JSON.parse(localStorage.getItem("saves"));let s=document.createElement("ol");s.classList.add("saved-games-page__list");for(let t=0;t<e.length;t++){let n=document.createElement("li");n.classList.add("saved-games-page__item"),n.textContent=e[t].info,n.addEventListener("click",(()=>{i.load(e[t])})),s.append(n)}this.element.append(s),this.element.append(t.backButton.element)}},scores:{element:null,init(){if(this.element=document.createElement("div"),this.element.classList.add("score-page"),localStorage.getItem("scores")){const e=JSON.parse(localStorage.getItem("scores"));e.sort(((e,t)=>e.moves-t.moves));let t=document.createElement("ol");t.classList.add("score-page__list");for(let s=0;s<e.length;s++){let i=document.createElement("li");i.classList.add("score-page__item"),i.textContent=`${e[s].date} | ${e[s].moves} moves | ${e[s].size}`,t.append(i),this.element.append(t)}}else{const e=document.createElement("div");e.textContent="You hasn't scores yet",e.classList.add("score-page__info"),this.element.append(e)}this.element.append(t.backButton.element)}},settings:{element:null,init(){this.element=document.createElement("div"),this.element.classList.add("settings-page");let e=document.createElement("select");e.classList.add("settings-page__sizes");for(let t=0;t<a.sizes.length;t++){const s=a.sizes[t],i=document.createElement("option");s===a.targetSize&&(i.selected=!0),i.value=s,i.textContent=`${s}x${s}`,e.append(i)}e.addEventListener("change",(()=>{const t=e.options.selectedIndex;a.selectedSize=+e.options[t].value})),this.element.append(e),this.element.append(t.backButton.element)}}},button:null,backButton:{element:null,init(){this.element=document.createElement("button"),this.element.classList.add("menu__back-button"),this.element.textContent="Back to menu",this.element.addEventListener("click",(()=>{t.back()}))}},init(){this.backButton.init(),this.element=document.createElement("div"),this.element.classList.add("menu"),this.pages.main.element=document.createElement("div"),this.pages.main.element.classList.add("main-page"),this.button=document.createElement("button"),this.button.classList.add("menu__button"),this.button.textContent="Menu",this.button.addEventListener("click",(()=>{this.show()})),this.pages.main.header=document.createElement("ul"),this.pages.main.header.classList.add("main-page__header");const e=document.createElement("li");e.textContent="continue",e.classList.add("main-page__header-item"),e.addEventListener("click",(()=>{i.continue()}));const t=document.createElement("li");t.textContent="save game",t.classList.add("main-page__header-item"),t.addEventListener("click",(()=>{i.save()})),this.pages.main.header.append(e,t),this.pages.main.container=document.createElement("ul"),this.pages.main.container.classList.add("main-page__list"),this.pages.main.items.newGame=document.createElement("li"),this.pages.main.items.newGame.textContent="New Game",this.pages.main.items.newGame.addEventListener("click",(()=>{i.start()})),this.pages.main.items.loadGame=document.createElement("li"),this.pages.main.items.loadGame.textContent="Load game",this.pages.main.items.loadGame.addEventListener("click",(()=>{localStorage.getItem("saves")&&(this.pages.saves.init(),this.element.textContent="",this.element.append(this.pages.saves.element))})),this.pages.main.items.scores=document.createElement("li"),this.pages.main.items.scores.textContent="Best Scores",this.pages.main.items.scores.addEventListener("click",(()=>{this.pages.scores.init(),this.element.textContent="",this.element.append(this.pages.scores.element)})),this.pages.main.items.settings=document.createElement("li"),this.pages.main.items.settings.textContent="Settings",this.pages.main.items.settings.addEventListener("click",(()=>{this.pages.settings.init(),this.element.textContent="",this.element.append(this.pages.settings.element)}));for(let e in this.pages.main.items)this.pages.main.items[e].classList.add("menu-item"),this.pages.main.container.append(this.pages.main.items[e]);this.pages.main.element.append(this.pages.main.header),this.pages.main.element.append(this.pages.main.container),this.show()},show(){e.pause(),this.element.textContent="",this.element.append(this.pages.main.element),this.pages.main.header.classList.toggle("main-page__header_hidden",!i.isStarted),this.element.classList.toggle("menu__hidden",!1)},close(){this.element.textContent="",this.element.append(this.pages.main.element),this.element.classList.toggle("menu__hidden",!0)},back(){this.element.textContent="",this.element.append(this.pages.main.element)}};class s{constructor(e,t,s,i){const n=new Date;this.info=`${n.getDate()}/${n.getMonth()+1}/${n.getFullYear()} ${n.getHours()}:${n.getMinutes()}`,this.timer=e,this.size=t,this.idChips=s,this.moves=i}}const i={isStarted:!1,messageElement:null,start(){this.messageElement.hidden=!0,this.isStarted=!0,t.close(),a.setGrid(),a.createIdChips(),a.createElements();do{a.mixChips()}while(!a.hasSolve());a.clear(),a.setChips(),e.restart(),n.restart(),e.start()},save(){let t=new s({min:e.min,sec:e.sec},a.targetSize,a.idChips,n.moves),i=localStorage.getItem("saves");i=null===i?[]:JSON.parse(i),5===i.length&&i.shift(),i.push(t),localStorage.setItem("saves",JSON.stringify(i))},load(t){this.messageElement.hidden=!0,e.min=t.timer.min,e.sec=t.timer.sec,e.setTime(),a.selectedSize=t.size,a.idChips=t.idChips,n.moves=t.moves,n.update(),a.load(),this.continue()},continue(){e.start(),t.close()},isSolved(){let e=a.idChips,t=[...Array(Math.pow(a.targetSize,2)).keys()];t.push(t.shift());for(let s=0;s<e.length;s++)if(t[s]!==e[s])return!1;return!0},end(){this.messageElement.textContent=`Ура! Вы решили головоломку за ${e._format(e.min)}:${e._format(e.sec)} и ${n.moves} ходов`,this.messageElement.hidden=!1,this.setScore()},setScore(){let e=localStorage.getItem("scores");e=null===e?[]:JSON.parse(localStorage.getItem("scores")),e.sort(((e,t)=>e.moves-t.moves)),10===e.length&&e.pop(),e.push({date:(new Date).toLocaleDateString(),moves:n.moves,size:`${a.targetSize}x${a.targetSize}`}),localStorage.setItem("scores",JSON.stringify(e))}},n={moves:0,element:null,chipIndex:void 0,emptyIndex:void 0,init(){this.element=document.createElement("div"),this.update()},restart(){this.moves=0,this.update()},canMove(e){this.chipIndex=a.childrens.indexOf(e),this.emptyIndex=a.childrens.indexOf(a.emptyChip);const t=Math.abs(this.chipIndex-this.emptyIndex),s=Math.trunc(this.emptyIndex/a.targetSize)+1;if(Math.trunc(this.chipIndex/a.targetSize)+1===s){if(1===t)return!0}else if(t===a.targetSize)return!0;return!1},move(e){void 0!==this.chipIndex&&void 0!==this.emptyIndex&&(a.childrens.splice(this.chipIndex,1,a.emptyChip),a.childrens.splice(this.emptyIndex,1,e),a.setChips()),this._incrementMoves(),this.chipIndex=this.emptyIndex=void 0,i.isSolved()&&i.end()},_incrementMoves(){this.moves++,this.update()},update(){this.element.textContent="Moves: "+this.moves}},a={element:null,emptyChip:null,childrens:[],idChips:[],sizes:[3,4,5,6,7,8],targetSize:4,selectedSize:void 0,isDragging:!1,init(){this.element=document.createElement("div"),this.element.addEventListener("click",(e=>{if(a.isDragging)return void(a.isDragging=!1);const t=e.target;t.classList.contains("board__chip")&&n.canMove(t)&&n.move(t)})),this.setGrid(),this.createIdChips(),this.createElements(),this.setChips()},setGrid(){this.element.classList.add("board"),this.selectedSize&&(this.element.classList.remove("board_size-"+this.targetSize),this.targetSize=this.selectedSize,this.selectedSize=void 0),this.element.classList.add("board_size-"+this.targetSize)},createIdChips(){this.idChips=[...Array(Math.pow(this.targetSize,2)).keys()],this.idChips.push(this.idChips.shift())},load(){this.setGrid(),this.clear(),this.createElements(),this.setChips()},createElements(){this.childrens=[];for(let e=0;e<this.idChips.length;e++){const t=this.idChips[e],s=document.createElement("div");0!==t?(s.classList.add("board__chip"),s.onmousedown=this.drag,s.textContent=s.dataset.id=t):(this.emptyChip=s,s.dataset.id=t,this.emptyChip.classList.add("board__empty")),this.childrens.push(s)}},drag(e){e.preventDefault();const t=e.currentTarget;let s=e.clientX-t.getBoundingClientRect().left,i=e.clientY-t.getBoundingClientRect().top;m(e.pageX,e.pageY);const n=document.createElement("div");n.classList.add("base-chip-position"),t.before(n);const l=t.offsetWidth;function m(e,n){t.style.left=e-s+"px",t.style.top=n-i+"px"}t.style.width=t.style.height=l+"px",t.style.position="absolute",document.onmouseup=function(){t.style.width=t.style.height=null,t.style.position=null,n.remove(),document.onmouseup=null,document.onmousemove=null},document.onmousemove=function(e){e.preventDefault(),m(e.pageX,e.pageY),a.isDragging=!0,t.style.display="none",a.emptyChip===document.elementFromPoint(e.clientX,e.clientY)&&(a.isDragging=!1),t.style.display=null}},mixChips(){let e=this.childrens.length;for(let t=0;t<e;e--){const t=Math.floor(Math.random()*e),s=this.childrens.splice(t,1)[0];this.childrens.push(s)}},hasSolve(){const e=Math.trunc(this.childrens.indexOf(this.emptyChip)/this.targetSize)+1,t=this.childrens.filter((e=>e!==this.emptyChip));let s=0;for(let e=0;e<t.length;e++){const i=+t[e].dataset.id;for(let n=e+1;n<t.length;n++)i>+t[n].dataset.id&&s++}return(s+e)%2==0},clear(){this.element.textContent=""},setChips(){this.childrens.forEach((e=>this.element.append(e))),this._updateIdChipsOrder()},_updateIdChipsOrder(){this.idChips=this.childrens.map((e=>+e.dataset.id))}};!function(){const s=document.createElement("div");s.classList.add("game-container"),i.messageElement=document.createElement("h3"),e.init(),n.init(),a.init(),t.init(),s.append(i.messageElement),s.append(e.element),s.append(n.element),s.append(t.button),s.append(a.element),s.append(t.element),document.body.append(s)}()})();